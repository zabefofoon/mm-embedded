import{d as N,N as L,u as C,a as v,c as u,w as B,o as n,b as y,e as l,f as x,g as K,v as T,h as S,i as b,F as r,r as M,j as _,n as P,k as A,_ as H,l as D,m as O,s as k,p as V,q as W,t as R,x as z,y as j,z as G,A as I,B as q}from"./index-fefaf01a.js";const F={key:0,class:"marker | absolute top-0 right-0 | w-3 h-3 | bg-orange-500"},U={class:"w-80 h-60 | absolute z-10 | bg-white border shadow-md"},Z=["innerHTML"],X={key:0,class:"w-full text-center text-slate-500"},J=N({__name:"Node",props:{node:{type:L,required:!0}},setup(i){const t=i,m=C(),s=v(),p=u(()=>m.isShowSpacing?"p-2":""),w=u(()=>m.isShowOutline?"border-2":"border-0"),g=u(()=>{var a;return(a=s.currentPage)!=null&&a.selectedIds.includes(t.node.id)?"border-orange-500":"border-slate-500"}),$=u(()=>Object.keys(t.node.layout).reduce((a,o)=>{let e="";return t.node.layout[o].type&&(e=e+`${o}:type-${t.node.layout[o].type} `),t.node.layout[o].direction&&(e=e+`${o}:direction-${t.node.layout[o].direction} `),t.node.layout[o].columns&&(e=e+`${o}:columns-${t.node.layout[o].columns} `),t.node.layout[o].gap&&(e=e+`${o}:gap-${t.node.layout[o].gap} `),t.node.layout[o].width&&(e=e+`${o}:width-${t.node.layout[o].width} `),t.node.layout[o].height&&(e=e+`${o}:height-${t.node.layout[o].height} `),t.node.layout[o].maxWidth&&(e=e+`${o}:maxWidth-${t.node.layout[o].maxWidth} `),t.node.layout[o].mainAxis!==void 0?e=e+`${o}:mainAxis-${t.node.layout[o].mainAxis} `:e=e+`${o}:mainAxis-start `,t.node.layout[o].crossAxis!==void 0?e=e+`${o}:crossAxis-${t.node.layout[o].crossAxis} `:e=e+`${o}:crossAxis-start `,t.node.layout[o].position!==void 0?e=e+`${o}:position-${t.node.layout[o].position} `:e=e+`${o}:position-relative `,t.node.layout[o].hidden!==void 0&&(e=e+`${o}:hidden-${t.node.layout[o].hidden||!1} `),t.node.layout[o].paddingLeft!==void 0&&(e=e+`${o}:padding-left-${t.node.layout[o].paddingLeft} `),t.node.layout[o].paddingTop!==void 0&&(e=e+`${o}:padding-top-${t.node.layout[o].paddingTop} `),t.node.layout[o].paddingRight!==void 0&&(e=e+`${o}:padding-right-${t.node.layout[o].paddingRight} `),t.node.layout[o].paddingBottom!==void 0&&(e=e+`${o}:padding-bottom-${t.node.layout[o].paddingBottom} `),t.node.layout[o].left!==void 0&&(e=e+`${o}:left-${t.node.layout[o].left} `),t.node.layout[o].top!==void 0&&(e=e+`${o}:top-${t.node.layout[o].top} `),t.node.layout[o].right!==void 0&&(e=e+`${o}:right-${t.node.layout[o].right} `),t.node.layout[o].bottom!==void 0&&(e=e+`${o}:bottom-${t.node.layout[o].bottom} `),t.node.layout[o].transparent&&(e=e+`${o}:transparent `),a+e},"")),f=()=>setTimeout(()=>{[...document.body.getElementsByClassName("marker")].forEach(a=>{a.getBoundingClientRect().left>document.body.clientWidth/2?a.getElementsByTagName("article")[0].classList.add("right-1"):a.getElementsByTagName("article")[0].classList.add("left-1"),a.getBoundingClientRect().top>document.body.clientHeight/2?a.getElementsByTagName("article")[0].classList.add("bottom-1"):a.getElementsByTagName("article")[0].classList.add("top-1")})});return B(()=>s.currentPage.nodes,()=>f(),{immediate:!0,deep:!0}),(a,o)=>{const e=A("Node",!0);return n(),y("div",{class:P(["node | w-full min-h-8 | border border-dashed",[l(g),l($),l(p),l(w)]]),onClick:o[2]||(o[2]=S(d=>d.ctrlKey||d.metaKey?l(s).selectNodeMany(i.node.id):l(s).selectNodeOne(i.node.id),["stop"]))},[l(m).isShowMarker&&i.node.marker?(n(),y("div",F,[x("article",U,[K(x("textarea",{"onUpdate:modelValue":o[0]||(o[0]=d=>i.node.marker.text=d),class:"w-full h-full | p-2 | resize-none text-slate-500 text-sm",placeholder:"text",onKeydown:o[1]||(o[1]=S(()=>{},["stop"]))},null,544),[[T,i.node.marker.text]])])])):b("",!0),i.node.widget?(n(),y("div",{key:1,innerHTML:i.node.widget.html,class:"w-full"},null,8,Z)):(n(),y(r,{key:2},[i.node.nodes.length===0?(n(),y("p",X,"space")):b("",!0),(n(!0),y(r,null,M(i.node.nodes,d=>(n(),_(e,{key:d.id,node:d},null,8,["node"]))),128))],64))],2)}}});const Q=H(J,[["__scopeId","data-v-63dd5bc6"]]),ee=N({__name:"canvas",setup(i){D(()=>{window.addEventListener("message",m),window.addEventListener("keydown",t)}),O(()=>{window.removeEventListener("message",m),window.removeEventListener("keydown",t)});const t=e=>{const d=e.ctrlKey||e.metaKey;e.code==="Delete"||e.code==="Backspace"?s("removeNode"):e.code==="Enter"&&d?s("addChildNode"):e.code==="Enter"?s("addSiblingNodeDown"):e.code==="KeyC"?s("copyNode"):e.code==="KeyX"?s("cutNode"):e.code==="KeyV"?s("pasteNode"):e.code==="KeyZ"&&d&&e.shiftKey?s("redo"):e.code==="KeyZ"&&d&&s("undo")},m=e=>{if(e.data.type==="pagesMutation"){const d=e.data.data;g.loadPages(d.pages),g.selectPage(d.currentPageId)}else if(e.data.type==="widgetGroupsMutation"){const d=e.data.data;f.setWidgetGroups(d)}else if(e.data.type==="screenMutation"){const{isShowSpacing:d,isShowOutline:h,isShowHidden:c,isShowMarker:E}=e.data.data;p.toggleShowSpacing(d),p.toggleShowOutline(h),p.toggleShowHidden(c),p.toggleMarker(E)}},s=e=>{var d;return(d=window.parent)==null?void 0:d.postMessage({type:"command",data:e})},p=C(),{isShowHidden:w}=k(p),g=v();B(()=>g.currentPage,e=>{var d;return(d=window.parent)==null?void 0:d.postMessage({type:"pageMutation",data:q(e)})},{deep:!0});const f=V(),{widgetGroups:a}=k(f),o=u(()=>{var e;return I((e=g.currentPage)==null?void 0:e.nodes,a.value,w.value)});return(e,d)=>{var h;return n(),y("div",{class:"bg-white shadow-md | min-h-screen",onClick:d[0]||(d[0]=c=>l(g).selectNodeOne())},[W(z,null,{default:R(()=>[j(G(l(o)),1)]),_:1}),(n(!0),y(r,null,M((h=l(g).currentPage)==null?void 0:h.nodes,c=>(n(),_(Q,{key:c.id,node:c},null,8,["node"]))),128))])}}});export{ee as default};
