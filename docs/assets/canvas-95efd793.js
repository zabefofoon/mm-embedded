import{d as N,N as L,u as C,a as B,c as f,w as v,o as l,b as y,e as g,f as k,g as K,v as T,h as x,i as S,F as $,r as M,j as _,n as A,k as P,_ as H,l as O,m as V,s as b,p as W,q as D,t as R,x as z,y as j,z as G,A as I,B as q}from"./index-3da51c7a.js";const F={key:0,class:"marker | absolute top-0 right-0 | w-3 h-3 | bg-orange-500"},U={class:"w-80 h-60 | absolute z-10 | bg-white border shadow-md"},Z=["innerHTML"],X={key:0,class:"w-full text-center text-slate-500"},J=N({__name:"Node",props:{node:{type:L,required:!0}},setup(i){const t=i,m=C(),s=B(),p=f(()=>m.isShowSpacing?"p-2":""),w=f(()=>m.isShowOutline?"border-2":"border-0"),n=f(()=>{var a;return(a=s.currentPage)!=null&&a.selectedIds.includes(t.node.id)?"border-orange-500":"border-slate-500"}),r=f(()=>Object.keys(t.node.layout).reduce((a,o)=>{let e="";return t.node.layout[o].type&&(e=e+`${o}:type-${t.node.layout[o].type} `),t.node.layout[o].direction&&(e=e+`${o}:direction-${t.node.layout[o].direction} `),t.node.layout[o].columns&&(e=e+`${o}:columns-${t.node.layout[o].columns} `),t.node.layout[o].gap&&(e=e+`${o}:gap-${t.node.layout[o].gap} `),t.node.layout[o].width&&(e=e+`${o}:width-${t.node.layout[o].width} `),t.node.layout[o].height&&(e=e+`${o}:height-${t.node.layout[o].height} `),t.node.layout[o].maxWidth&&(e=e+`${o}:maxWidth-${t.node.layout[o].maxWidth} `),t.node.layout[o].mainAxis!==void 0?e=e+`${o}:mainAxis-${t.node.layout[o].mainAxis} `:e=e+`${o}:mainAxis-start `,t.node.layout[o].crossAxis!==void 0?e=e+`${o}:crossAxis-${t.node.layout[o].crossAxis} `:e=e+`${o}:crossAxis-start `,t.node.layout[o].position!==void 0?e=e+`${o}:position-${t.node.layout[o].position} `:e=e+`${o}:position-relative `,t.node.layout[o].hidden!==void 0&&(e=e+`${o}:hidden-${t.node.layout[o].hidden||!1} `),t.node.layout[o].paddingLeft!==void 0&&(e=e+`${o}:padding-left-${t.node.layout[o].paddingLeft} `),t.node.layout[o].paddingTop!==void 0&&(e=e+`${o}:padding-top-${t.node.layout[o].paddingTop} `),t.node.layout[o].paddingRight!==void 0&&(e=e+`${o}:padding-right-${t.node.layout[o].paddingRight} `),t.node.layout[o].paddingBottom!==void 0&&(e=e+`${o}:padding-bottom-${t.node.layout[o].paddingBottom} `),t.node.layout[o].left!==void 0&&(e=e+`${o}:left-${t.node.layout[o].left} `),t.node.layout[o].top!==void 0&&(e=e+`${o}:top-${t.node.layout[o].top} `),t.node.layout[o].right!==void 0&&(e=e+`${o}:right-${t.node.layout[o].right} `),t.node.layout[o].bottom!==void 0&&(e=e+`${o}:bottom-${t.node.layout[o].bottom} `),t.node.layout[o].transparent&&(e=e+`${o}:transparent `),a+e},"")),u=()=>setTimeout(()=>{[...document.body.getElementsByClassName("marker")].forEach(a=>{a.getBoundingClientRect().left>document.body.clientWidth/2?a.getElementsByTagName("article")[0].classList.add("right-1"):a.getElementsByTagName("article")[0].classList.add("left-1"),a.getBoundingClientRect().top>document.body.clientHeight/2?a.getElementsByTagName("article")[0].classList.add("bottom-1"):a.getElementsByTagName("article")[0].classList.add("top-1")})});return v(()=>s.currentPage.nodes,()=>u(),{immediate:!0,deep:!0}),(a,o)=>{const e=P("Node",!0);return l(),y("div",{class:A(["node | w-full min-h-8 | border border-dashed",[g(n),g(r),g(p),g(w)]]),onClick:o[2]||(o[2]=x(d=>d.ctrlKey||d.metaKey?g(s).selectNodeMany(i.node.id):g(s).selectNodeOne(i.node.id),["stop"]))},[g(m).isShowMarker&&i.node.marker?(l(),y("div",F,[k("article",U,[K(k("textarea",{"onUpdate:modelValue":o[0]||(o[0]=d=>i.node.marker.text=d),class:"w-full h-full | p-2 | resize-none text-slate-500 text-sm",placeholder:"text",onKeydown:o[1]||(o[1]=x(()=>{},["stop"]))},null,544),[[T,i.node.marker.text]])])])):S("",!0),i.node.widget?(l(),y("div",{key:1,innerHTML:i.node.widget.html,class:"w-full"},null,8,Z)):(l(),y($,{key:2},[i.node.nodes.length===0?(l(),y("p",X,"space")):S("",!0),(l(!0),y($,null,M(i.node.nodes,d=>(l(),_(e,{key:d.id,node:d},null,8,["node"]))),128))],64))],2)}}});const Q=H(J,[["__scopeId","data-v-63dd5bc6"]]),ee=N({__name:"canvas",setup(i){O(()=>{window.addEventListener("message",m),window.addEventListener("keydown",t)}),V(()=>{window.removeEventListener("message",m),window.removeEventListener("keydown",t)});const t=e=>{const d=e.ctrlKey||e.metaKey;e.code==="Delete"||e.code==="Backspace"?s("removeNode"):e.code==="Enter"&&d?s("addChildNode"):e.code==="Enter"?s("addSiblingNodeDown"):e.code==="KeyC"?s("copyNode"):e.code==="KeyX"?s("cutNode"):e.code==="KeyV"?s("pasteNode"):e.code==="KeyZ"&&d&&e.shiftKey?s("redo"):e.code==="KeyZ"&&d&&s("undo")},m=e=>{if(e.data.type==="pagesMutation"){const d=e.data.data;n.loadPages(d.pages),n.selectPage(d.currentPageId)}else if(e.data.type==="widgetGroupsMutation"){const d=e.data.data;u.setWidgetGroups(d)}else if(e.data.type==="screenMutation"){const{isShowSpacing:d,isShowOutline:h,isShowHidden:c,isShowMarker:E}=e.data.data;p.toggleShowSpacing(d),p.toggleShowOutline(h),p.toggleShowHidden(c),p.toggleMarker(E)}},s=e=>{var d;return(d=window.parent)==null?void 0:d.postMessage({type:"command",data:e})},p=C(),{isShowHidden:w}=b(p),n=B(),r=e=>{var d;n.circuitBreaker.status==="off"&&((d=window.parent)==null||d.postMessage({type:"pageMutation",data:q(e)}))};v(()=>n.currentPage,e=>{n.circuitBreaker.watch(e.key),r(e)},{deep:!0});const u=W(),{widgetGroups:a}=b(u),o=f(()=>{var e;return I((e=n.currentPage)==null?void 0:e.nodes,a.value,w.value)});return(e,d)=>{var h;return l(),y("div",{class:"bg-white shadow-md | min-h-screen",onClick:d[0]||(d[0]=c=>g(n).selectNodeOne())},[D(z,null,{default:R(()=>[j(G(g(o)),1)]),_:1}),(l(!0),y($,null,M((h=g(n).currentPage)==null?void 0:h.nodes,c=>(l(),_(Q,{key:c.id,node:c},null,8,["node"]))),128))])}}});export{ee as default};
